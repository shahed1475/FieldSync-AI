"use strict";(()=>{var e={};e.id=777,e.ids=[777],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},75616:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>m});var o=r(63036),a=r(5736),n=r(15262),i=r(60942),u=r(96524),l=r(74685),c=r(95511),p=r(72842),d=r(97055);async function m(){let e=await (0,l.k)();if(e)return e;try{let e=new Date,t=(0,c.Z)(e);!function(e){(0,d.Z)(1,arguments);var t=(0,p.Z)(e),r=new Date(0);r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0)}(e);let[r,s,o,a,n,l,m,g,h,y]=await Promise.all([u._.user.count().catch(()=>0),u._.user.count({where:{createdAt:{gte:t}}}).catch(()=>0),u._.project.count().catch(()=>0),u._.project.count({where:{createdAt:{gte:t}}}).catch(()=>0),u._.project.count({where:{status:"completed"}}).catch(()=>0),u._.subscription.count({where:{status:"active"}}).catch(()=>0),u._.revenue.aggregate({_sum:{amount:!0}}).catch(()=>({_sum:{amount:0}})),u._.revenue.aggregate({_sum:{amount:!0},where:{createdAt:{gte:t}}}).catch(()=>({_sum:{amount:0}})),u._.subscription.groupBy({by:["plan"],where:{status:"active"},_count:{plan:!0}}).catch(()=>[]),u._.project.groupBy({by:["status"],_count:{status:!0}}).catch(()=>[])]),w=r-s,f=w>0?(s/w*100).toFixed(1):"0",b=o>0?(n/o*100).toFixed(1):"0",x={users:{total:r,thisMonth:s,growth:f},projects:{total:o,thisMonth:a,completed:n,completionRate:b,statusBreakdown:y},subscriptions:{active:l,breakdown:h},revenue:{total:m._sum.amount||0,thisMonth:g._sum.amount||0,currency:"USD"},system:{status:"ok",timestamp:e.toISOString()},timestamp:e.toISOString()};return i.NextResponse.json(x)}catch(e){return console.error("[Analytics API Error]:",e),i.NextResponse.json({error:"Failed to fetch analytics",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"C:\\Users\\shahe\\OneDrive\\Desktop\\OTRIX\\OtriX\\apps\\web\\src\\app\\api\\admin\\analytics\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:w}=g,f="/api/admin/analytics/route";function b(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}},28753:(e,t,r)=>{r.r(t),r.d(t,{GET:()=>p,POST:()=>p,authOptions:()=>c});var s=r(59224),o=r.n(s),a=r(18452),n=r(53524);let i=require("bcrypt");var u=r.n(i);let l=new n.PrismaClient,c={providers:[(0,a.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return console.log("❌ Missing credentials"),null;try{let t=await l.user.findUnique({where:{email:e.email}});if(!t||!t.password)return console.log("❌ User not found:",e.email),null;if(!await u().compare(e.password,t.password))return console.log("❌ Invalid password for:",e.email),null;return console.log("✅ Login successful:",t.email,"Role:",t.role),await l.user.update({where:{id:t.id},data:{lastLoginAt:new Date}}),{id:t.id,email:t.email,name:t.name,role:t.role}}catch(e){return console.error("❌ Authorization error:",e),null}}})],session:{strategy:"jwt",maxAge:2592e3},pages:{signIn:"/login",error:"/login"},callbacks:{jwt:async({token:e,user:t,trigger:r})=>(t&&(e.userId=t.id,e.email=t.email,e.name=t.name,e.role=t.role,console.log("\uD83D\uDD11 JWT token created for user:",t.email,"with role:",t.role)),e),session:async({session:e,token:t})=>(e.user&&t&&(e.user.id=t.userId||t.sub,e.user.email=t.email,e.user.name=t.name,e.user.role=t.role,console.log("\uD83D\uDCDD Session created for user:",t.email,"with role:",t.role)),e),redirect:async({url:e,baseUrl:t})=>(console.log("\uD83D\uDD00 Redirect callback triggered - url:",e,"baseUrl:",t),e.startsWith("/"))?(console.log("✅ Redirecting to relative URL:",`${t}${e}`),`${t}${e}`):new URL(e).origin===t?(console.log("✅ Redirecting to same origin:",e),e):(console.log("✅ Redirecting to default /admin"),`${t}/admin`)},secret:process.env.NEXTAUTH_SECRET,debug:!1},p=o()(c)},74685:(e,t,r)=>{r.d(t,{k:()=>n});var s=r(59224),o=r(28753),a=r(60942);async function n(){let e=await (0,s.getServerSession)(o.authOptions);if(!e||!e.user)return a.NextResponse.json({error:"Unauthorized",message:"Please sign in"},{status:401});let t=e.user.role;return"admin"!==t&&"superadmin"!==t?a.NextResponse.json({error:"Forbidden",message:"Admin access required"},{status:403}):null}},96524:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(53524);let o=global.prisma||new s.PrismaClient},97055:(e,t,r)=>{r.d(t,{Z:()=>s});function s(e,t){if(t.length<e)throw TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}},95511:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(72842),o=r(97055);function a(e){(0,o.Z)(1,arguments);var t=(0,s.Z)(e);return t.setDate(1),t.setHours(0,0,0,0),t}},72842:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(88439),o=r(97055);function a(e){(0,o.Z)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,s.Z)(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):(("string"==typeof e||"[object String]"===t)&&"undefined"!=typeof console&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(Error().stack)),new Date(NaN))}},88439:(e,t,r)=>{r.d(t,{Z:()=>s});function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[193,631,942],()=>r(75616));module.exports=s})();